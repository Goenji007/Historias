<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Historias de la Enfermera Panda y el Doctor Mono</title>
    <!-- Tailwind CSS -->
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <!-- FontAwesome -->
    <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css" rel="stylesheet">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@400;500;600;700&family=Nunito:wght@300;400;600;700&display=swap" rel="stylesheet">
    <!-- Twemoji -->
    <script src="https://cdn.jsdelivr.net/npm/twemoji@14.0.2/dist/twemoji.min.js"></script>
    <style>
        :root {
            --primary-color: #FF9BE8;
            --secondary-color: #89CFF0;
            --tertiary-color: #FCFF5D;
            --accent-color: #FF6B6B;
            --background-gradient: linear-gradient(45deg, #FFD6FF, #E7C6FF, #B8C0FF, #C8F7FF);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Nunito', sans-serif;
            background: var(--background-gradient);
            background-size: 400% 400%;
            animation: gradient-shift 15s ease infinite;
            min-height: 100vh;
            padding: 2rem 1rem;
        }
        
        h1, h2, h3, h4, h5, h6 {
            font-family: 'Baloo 2', cursive;
        }
        
        /* Animaciones generales */
        @keyframes gradient-shift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes fadeInLeft {
            from { opacity: 0; transform: translateX(-50px); }
            to { opacity: 1; transform: translateX(0); }
        }
        
        @keyframes fadeInRight {
            from { opacity: 0; transform: translateX(50px); }
            to { opacity: 1; transform: translateX(0); }
        }
        
        @keyframes rainbow-border {
            0% { border-color: #ff0000; }
            14% { border-color: #ff7f00; }
            28% { border-color: #ffff00; }
            42% { border-color: #00ff00; }
            56% { border-color: #0000ff; }
            70% { border-color: #4b0082; }
            84% { border-color: #9400d3; }
            100% { border-color: #ff0000; }
        }
        
        /* Estilos especÃ­ficos de la aplicaciÃ³n */
        .main-container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .app-title {
            font-size: 2.5rem;
            font-weight: 700;
            text-align: center;
            color: #512B81;
            margin-bottom: 1.5rem;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
            animation: pulse 2s infinite ease-in-out;
        }
        
        .card {
            background-color: rgba(255, 255, 255, 0.85);
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.2);
            backdrop-filter: blur(4px);
            padding: 2rem;
            margin-bottom: 2rem;
            border: 4px solid transparent;
            transition: all 0.3s ease;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(31, 38, 135, 0.3);
        }
        
        .rainbow-border {
            animation: rainbow-border 5s linear infinite;
        }
        
        .character-card {
            text-align: center;
            padding: 1.5rem;
            animation: fadeIn 1s, float 3s infinite ease-in-out;
        }
        
        .character-emoji {
            font-size: 5rem;
            margin-bottom: 1rem;
        }
        
        .character-name {
            font-size: 1.8rem;
            font-weight: 700;
            color: #512B81;
            margin-bottom: 0.5rem;
        }
        
        .character-quote {
            font-style: italic;
            color: #666;
        }
        
        .form-container {
            animation: fadeIn 1s 0.3s both;
        }
        
        .select-group {
            margin-bottom: 1.5rem;
        }
        
        .select-label {
            display: block;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: #512B81;
        }
        
        .custom-select {
            width: 100%;
            padding: 0.75rem 1rem;
            border-radius: 10px;
            border: 2px solid #ddd;
            background-color: white;
            font-family: 'Nunito', sans-serif;
            font-size: 1rem;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .custom-select:hover {
            border-color: var(--primary-color);
            transform: translateY(-2px);
        }
        
        .custom-select:focus {
            outline: none;
            border-color: var(--secondary-color);
            box-shadow: 0 0 0 3px rgba(137, 207, 240, 0.3);
        }
        
        .submit-btn {
            background: linear-gradient(45deg, #FF9BE8, #89CFF0);
            color: white;
            font-family: 'Baloo 2', cursive;
            font-size: 1.2rem;
            font-weight: 600;
            padding: 0.75rem 2rem;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            display: block;
            margin: 2rem auto;
            animation: pulse 2s infinite;
        }
        
        .submit-btn:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 7px 20px rgba(0, 0, 0, 0.25);
        }
        
        .story-container {
            display: none;
            animation: fadeIn 1s;
        }
        
        .story-title {
            font-size: 2rem;
            color: #512B81;
            text-align: center;
            margin-bottom: 1.5rem;
            animation: fadeIn 1s;
        }
        
        .story-paragraph {
            margin-bottom: 1.2rem;
            line-height: 1.6;
            font-size: 1.1rem;
            opacity: 0;
        }
        
        .story-emoji {
            font-size: 1.5rem;
            margin: 0 0.2rem;
            vertical-align: middle;
        }
        
        .new-story-btn {
            background: linear-gradient(45deg, #89CFF0, #FCFF5D);
            color: #512B81;
            font-family: 'Baloo 2', cursive;
            font-size: 1.2rem;
            font-weight: 600;
            padding: 0.75rem 2rem;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            display: block;
            margin: 2rem auto;
        }
        
        .new-story-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 7px 20px rgba(0, 0, 0, 0.25);
        }
        
        .footer {
            text-align: center;
            margin-top: 3rem;
            color: #512B81;
            font-size: 0.9rem;
        }
        
        /* AnimaciÃ³n para el loading entre la generaciÃ³n de historia */
        .loading {
            display: none;
            text-align: center;
            margin: 2rem 0;
        }
        
        .loading-dots {
            display: inline-block;
        }
        
        .loading-dots span {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background-color: #512B81;
            margin: 0 5px;
        }
        
        .loading-dots span:nth-child(1) {
            animation: bounce 1s infinite 0s;
        }
        
        .loading-dots span:nth-child(2) {
            animation: bounce 1s infinite 0.2s;
        }
        
        .loading-dots span:nth-child(3) {
            animation: bounce 1s infinite 0.4s;
        }
        
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-15px); }
        }
        
        /* Responsive tweaks */
        @media (max-width: 768px) {
            .app-title {
                font-size: 2rem;
            }
            
            .character-emoji {
                font-size: 4rem;
            }
            
            .character-name {
                font-size: 1.5rem;
            }
            
            .story-title {
                font-size: 1.8rem;
            }
        }
    </style>
</head>
<body>
    <div class="main-container">
        <h1 class="app-title">Historias de la Enfermera Panda y el Doctor Mono</h1>
        
        <!-- SecciÃ³n de personajes -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
            <div class="character-card card rainbow-border" style="animation-delay: 0s;">
                <div class="character-emoji">ğŸ¼</div>
                <h2 class="character-name">Enfermera Panda</h2>
                <p class="character-quote">"Â¡Con una sonrisa y un abrazo, cualquier dolor se va volando!"</p>
                <p class="mt-4">La Enfermera Panda es dulce y cariÃ±osa. Siempre sabe cÃ³mo hacer sentir mejor a sus pacientes con su paciencia infinita y su bolsa llena de vendas coloridas.</p>
            </div>
            
            <div class="character-card card rainbow-border" style="animation-delay: 0.5s;">
                <div class="character-emoji">ğŸ’</div>
                <h2 class="character-name">Doctor Mono</h2>
                <p class="character-quote">"Â¡La mejor medicina es reÃ­r tres veces al dÃ­a!"</p>
                <p class="mt-4">El Doctor Mono es juguetÃ³n y divertido. Con sus chistes y bromas hace que hasta los tratamientos mÃ¡s aburridos se conviertan en aventuras emocionantes.</p>
            </div>
        </div>
        
        <!-- Formulario de personalizaciÃ³n -->
        <div class="form-container card">
            <h2 class="text-xl md:text-2xl font-bold text-center mb-6 text-indigo-900">Â¡Crea tu propia historia!</h2>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="select-group">
                    <label for="childName" class="select-label">Nombre del niÃ±o/a (opcional)</label>
                    <input type="text" id="childName" class="custom-select" placeholder="Deja en blanco para no incluir un nombre">
                </div>
                
                <div class="select-group">
                    <label for="place" class="select-label">Lugar de la historia</label>
                    <select id="place" class="custom-select">
                        <option value="hospital">Hospital ğŸ¥</option>
                        <option value="parque">Parque ğŸŒ³</option>
                        <option value="escuela">Escuela ğŸ«</option>
                        <option value="playa">Playa ğŸ–ï¸</option>
                        <option value="bosque">Bosque ğŸŒ²</option>
                        <option value="zoo">ZoolÃ³gico ğŸ¦</option>
                        <option value="granja">Granja ğŸ„</option>
                        <option value="casa">Casa ğŸ </option>
                        <option value="montaÃ±a">MontaÃ±a â›°ï¸</option>
                        <option value="espacio">Espacio exterior ğŸš€</option>
                        <option value="circo">Circo ğŸª</option>
                        <option value="biblioteca">Biblioteca ğŸ“š</option>
                    </select>
                </div>
                
                <div class="select-group">
                    <label for="problem" class="select-label">Problema a resolver</label>
                    <select id="problem" class="custom-select">
                        <option value="resfriado">Resfriado ğŸ¤§</option>
                        <option value="miedo">Miedo a la oscuridad ğŸŒ™</option>
                        <option value="herida">Herida en la rodilla ğŸ©¹</option>
                        <option value="tristeza">Tristeza ğŸ˜¢</option>
                        <option value="pesadilla">Pesadilla ğŸ˜±</option>
                        <option value="soledad">Soledad ğŸ§¸</option>
                        <option value="compartir">No querer compartir ğŸ¤²</option>
                        <option value="dientes">Dolor de dientes ğŸ¦·</option>
                        <option value="berrinche">Berrinche ğŸ˜¤</option>
                        <option value="comida">No querer comer verduras ğŸ¥¦</option>
                        <option value="perdido">Estar perdido ğŸ—ºï¸</option>
                        <option value="amistad">Hacer nuevos amigos ğŸ‘‹</option>
                    </select>
                </div>
                
                <div class="select-group">
                    <label for="friend" class="select-label">Amigo que aparece</label>
                    <select id="friend" class="custom-select">
                        <option value="leon">LeÃ³n ğŸ¦</option>
                        <option value="jirafa">Jirafa ğŸ¦’</option>
                        <option value="elefante">Elefante ğŸ˜</option>
                        <option value="tigre">Tigre ğŸ¯</option>
                        <option value="conejo">Conejo ğŸ°</option>
                        <option value="tortuga">Tortuga ğŸ¢</option>
                        <option value="mariposa">Mariposa ğŸ¦‹</option>
                        <option value="delfin">DelfÃ­n ğŸ¬</option>
                        <option value="buho">BÃºho ğŸ¦‰</option>
                        <option value="perro">Perro ğŸ¶</option>
                        <option value="gato">Gato ğŸ±</option>
                        <option value="dragon">DragÃ³n ğŸ²</option>
                    </select>
                </div>
                
                <div class="select-group">
                    <label for="weather" class="select-label">Clima de la historia</label>
                    <select id="weather" class="custom-select">
                        <option value="soleado">Soleado â˜€ï¸</option>
                        <option value="lluvia">Lluvioso ğŸŒ§ï¸</option>
                        <option value="nieve">Nevado â„ï¸</option>
                        <option value="tormenta">Tormenta elÃ©ctrica âš¡</option>
                        <option value="arcoiris">ArcoÃ­ris ğŸŒˆ</option>
                        <option value="niebla">Niebla ğŸŒ«ï¸</option>
                        <option value="viento">Ventoso ğŸŒªï¸</option>
                        <option value="calor">Mucho calor ğŸ”¥</option>
                        <option value="estrellado">Noche estrellada âœ¨</option>
                        <option value="nublado">Nublado â˜ï¸</option>
                    </select>
                </div>
                
                <div class="select-group">
                    <label for="magicObject" class="select-label">Objeto mÃ¡gico</label>
                    <select id="magicObject" class="custom-select">
                        <option value="varita">Varita mÃ¡gica âœ¨</option>
                        <option value="pocion">PociÃ³n burbujeante ğŸ§ª</option>
                        <option value="mapa">Mapa del tesoro ğŸ—ºï¸</option>
                        <option value="espejo">Espejo encantado ğŸª</option>
                        <option value="lampara">LÃ¡mpara maravillosa ğŸª”</option>
                        <option value="libro">Libro de hechizos ğŸ“•</option>
                        <option value="llave">Llave dorada ğŸ”‘</option>
                        <option value="reloj">Reloj que detiene el tiempo â°</option>
                        <option value="semilla">Semilla que crece instantÃ¡neamente ğŸŒ±</option>
                        <option value="baston">BastÃ³n de nubes â˜ï¸</option>
                        <option value="alfombra">Alfombra voladora ğŸ§</option>
                        <option value="caramelo">Caramelo de superpoders ğŸ¬</option>
                    </select>
                </div>
                
                <div class="select-group">
                    <label for="ending" class="select-label">Final de la historia</label>
                    <select id="ending" class="custom-select">
                        <option value="fiesta">Fiesta de celebraciÃ³n ğŸ‰</option>
                        <option value="aprendizaje">LecciÃ³n aprendida ğŸ“</option>
                        <option value="amistad">Nueva amistad ğŸ¤</option>
                        <option value="aventura">Nueva aventura ğŸ§­</option>
                        <option value="regalo">Regalo sorpresa ğŸ</option>
                        <option value="cancion">CanciÃ³n alegre ğŸµ</option>
                        <option value="abrazo">Abrazo grupal ğŸ«‚</option>
                        <option value="estrella">Deseo a una estrella â­</option>
                        <option value="arcoiris">ArcoÃ­ris mÃ¡gico ğŸŒˆ</option>
                        <option value="dormir">Dulces sueÃ±os ğŸ’¤</option>
                    </select>
                </div>
            </div>
            
            <button id="generateBtn" class="submit-btn">Â¡Generar Historia MÃ¡gica!</button>
        </div>
        
        <!-- Loading indicator -->
        <div class="loading" id="loadingIndicator">
            <p class="font-bold text-indigo-900 mb-3">Creando una historia maravillosa...</p>
            <div class="loading-dots">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
        
        <!-- Contenedor de la historia -->
        <div class="story-container card" id="storyContainer">
            <h2 class="story-title" id="storyTitle">TÃ­tulo de la Historia</h2>
            <div id="storyContent"></div>
            <button id="newStoryBtn" class="new-story-btn">Â¡Crear otra historia!</button>
        </div>
        
        <footer class="footer">
            <p>Â© 2025, Historias de la Enfermera Panda y el Doctor Mono | Todos los derechos reservados DR GÃ“MEZ</p>
        </footer>
    </div>
    
    <script>
        // Inicializar Twemoji
        window.onload = function() {
            twemoji.parse(document.body, {
                folder: 'svg',
                ext: '.svg'
            });
        };
        
        // Variables y elementos
        const generateBtn = document.getElementById('generateBtn');
        const newStoryBtn = document.getElementById('newStoryBtn');
        const formContainer = document.querySelector('.form-container');
        const storyContainer = document.getElementById('storyContainer');
        const loadingIndicator = document.getElementById('loadingIndicator');
        const storyTitle = document.getElementById('storyTitle');
        const storyContent = document.getElementById('storyContent');
        
        // TÃ­tulos aleatorios para las historias
        const storyTitles = [
            "La Gran Aventura de CuraciÃ³n",
            "Un DÃ­a Especial con Panda y Mono",
            "La MisiÃ³n de Ayuda MÃ¡gica",
            "El Problema Especial",
            "El Rescate IncreÃ­ble",
            "Una LecciÃ³n para Recordar",
            "La Sorpresa del Doctor Mono",
            "El Plan Secreto de la Enfermera Panda",
            "Un Momento de ValentÃ­a",
            "El Misterio del DÃ­a ExtraÃ±o",
            "La SoluciÃ³n Inesperada",
            "Aventuras de Amistad y Coraje",
            "El DÃ­a que Todo CambiÃ³",
            "La Magia de Ayudar a los DemÃ¡s"
        ];
        
        // Emojis asociados a cada opciÃ³n
        const emojiMap = {
            places: {
                hospital: "ğŸ¥",
                parque: "ğŸŒ³",
                escuela: "ğŸ«",
                playa: "ğŸ–ï¸",
                bosque: "ğŸŒ²",
                zoo: "ğŸ¦",
                granja: "ğŸ„",
                casa: "ğŸ ",
                montaÃ±a: "â›°ï¸",
                espacio: "ğŸš€",
                circo: "ğŸª",
                biblioteca: "ğŸ“š"
            },
            problems: {
                resfriado: "ğŸ¤§",
                miedo: "ğŸŒ™",
                herida: "ğŸ©¹",
                tristeza: "ğŸ˜¢",
                pesadilla: "ğŸ˜±",
                soledad: "ğŸ§¸",
                compartir: "ğŸ¤²",
                dientes: "ğŸ¦·",
                berrinche: "ğŸ˜¤",
                comida: "ğŸ¥¦",
                perdido: "ğŸ—ºï¸",
                amistad: "ğŸ‘‹"
            },
            friends: {
                leon: "ğŸ¦",
                jirafa: "ğŸ¦’",
                elefante: "ğŸ˜",
                tigre: "ğŸ¯",
                conejo: "ğŸ°",
                tortuga: "ğŸ¢",
                mariposa: "ğŸ¦‹",
                delfin: "ğŸ¬",
                buho: "ğŸ¦‰",
                perro: "ğŸ¶",
                gato: "ğŸ±",
                dragon: "ğŸ²"
            },
            weather: {
                soleado: "â˜€ï¸",
                lluvia: "ğŸŒ§ï¸",
                nieve: "â„ï¸",
                tormenta: "âš¡",
                arcoiris: "ğŸŒˆ",
                niebla: "ğŸŒ«ï¸",
                viento: "ğŸŒªï¸",
                calor: "ğŸ”¥",
                estrellado: "âœ¨",
                nublado: "â˜ï¸"
            },
            magicObjects: {
                varita: "âœ¨",
                pocion: "ğŸ§ª",
                mapa: "ğŸ—ºï¸",
                espejo: "ğŸª",
                lampara: "ğŸª”",
                libro: "ğŸ“•",
                llave: "ğŸ”‘",
                reloj: "â°",
                semilla: "ğŸŒ±",
                baston: "â˜ï¸",
                alfombra: "ğŸ§",
                caramelo: "ğŸ¬"
            },
            endings: {
                fiesta: "ğŸ‰",
                aprendizaje: "ğŸ“",
                amistad: "ğŸ¤",
                aventura: "ğŸ§­",
                regalo: "ğŸ",
                cancion: "ğŸµ",
                abrazo: "ğŸ«‚",
                estrella: "â­",
                arcoiris: "ğŸŒˆ",
                dormir: "ğŸ’¤"
            }
        };
        
        // Event Listeners
        generateBtn.addEventListener('click', generateStory);
        newStoryBtn.addEventListener('click', resetStory);
        
        // Funciones para generar historias
        function generateStory() {
            // Mostrar indicador de carga
            formContainer.style.display = 'none';
            loadingIndicator.style.display = 'block';
            
            // Obtener valores seleccionados
            const childName = document.getElementById('childName').value.trim();
            const place = document.getElementById('place').value;
            const problem = document.getElementById('problem').value;
            const friend = document.getElementById('friend').value;
            const weather = document.getElementById('weather').value;
            const magicObject = document.getElementById('magicObject').value;
            const ending = document.getElementById('ending').value;
            
            // Nombres legibles para los valores seleccionados
            const placeNames = {
                hospital: "el hospital", parque: "el parque", escuela: "la escuela", playa: "la playa",
                bosque: "el bosque", zoo: "el zoolÃ³gico", granja: "la granja", casa: "la casa",
                montaÃ±a: "la montaÃ±a", espacio: "el espacio exterior", circo: "el circo", biblioteca: "la biblioteca"
            };
            
            const problemNames = {
                resfriado: "un fuerte resfriado", miedo: "miedo a la oscuridad", herida: "una herida en la rodilla",
                tristeza: "una gran tristeza", pesadilla: "terribles pesadillas", soledad: "sentirse solo",
                compartir: "no querer compartir juguetes", dientes: "un dolor de dientes",
                berrinche: "un gran berrinche", comida: "no querer comer verduras",
                perdido: "haberse perdido", amistad: "dificultad para hacer amigos"
            };
            
            const friendNames = {
                leon: "LeÃ³n Leo", jirafa: "Jirafa Juana", elefante: "Elefante Eli", tigre: "Tigre TomÃ¡s",
                conejo: "Conejo Carlos", tortuga: "Tortuga Tina", mariposa: "Mariposa Mia", delfin: "DelfÃ­n Dani",
                buho: "BÃºho Bruno", perro: "Perro Paco", gato: "Gata Gala", dragon: "DragÃ³n Dante"
            };
            
            const weatherDescriptions = {
                soleado: "un dÃ­a soleado y brillante", lluvia: "un dÃ­a lluvioso con gotas de agua bailando",
                nieve: "un hermoso dÃ­a nevado con copos blancos cayendo", tormenta: "un dÃ­a de tormenta con relÃ¡mpagos asombrosos",
                arcoiris: "un dÃ­a con un arcoÃ­ris gigante en el cielo", niebla: "un dÃ­a con niebla misteriosa",
                viento: "un dÃ­a ventoso con hojas danzando", calor: "un dÃ­a muy caluroso",
                estrellado: "una noche estrellada con estrellas brillantes", nublado: "un dÃ­a nublado con nubes esponjosas"
            };
            
            const magicObjectNames = {
                varita: "una varita mÃ¡gica brillante", pocion: "una pociÃ³n burbujeante de colores",
                mapa: "un mapa del tesoro antiguo", espejo: "un espejo encantado parlante",
                lampara: "una lÃ¡mpara maravillosa dorada", libro: "un libro de hechizos con pÃ¡ginas luminosas",
                llave: "una llave dorada que abre cualquier puerta", reloj: "un reloj que puede detener el tiempo",
                semilla: "una semilla mÃ¡gica que crece en segundos", baston: "un bastÃ³n que crea nubes suaves",
                alfombra: "una pequeÃ±a alfombra voladora", caramelo: "un caramelo que da superpoderes temporales"
            };
            
            const endingDescriptions = {
                fiesta: "una gran fiesta de celebraciÃ³n con mÃºsica y baile",
                aprendizaje: "aprendiendo una valiosa lecciÃ³n sobre la vida",
                amistad: "el inicio de una hermosa amistad que durarÃ­a para siempre",
                aventura: "el comienzo de una nueva aventura aÃºn mÃ¡s emocionante",
                regalo: "un regalo sorpresa especial que nadie esperaba",
                cancion: "todos cantando una canciÃ³n alegre y divertida",
                abrazo: "un cÃ¡lido abrazo grupal lleno de cariÃ±o",
                estrella: "pedir un deseo especial a la primera estrella de la noche",
                arcoiris: "la apariciÃ³n de un arcoÃ­ris mÃ¡gico que cumplÃ­a deseos",
                dormir: "todos durmiendo con dulces sueÃ±os y sonrisas"
            };
            
            // Construir la historia
            const placeText = placeNames[place];
            const problemText = problemNames[problem];
            const friendText = friendNames[friend];
            const weatherText = weatherDescriptions[weather];
            const magicObjectText = magicObjectNames[magicObject];
            const endingText = endingDescriptions[ending];
            
            const placeEmoji = emojiMap.places[place];
            const problemEmoji = emojiMap.problems[problem];
            const friendEmoji = emojiMap.friends[friend];
            const weatherEmoji = emojiMap.weather[weather];
            const magicObjectEmoji = emojiMap.magicObjects[magicObject];
            const endingEmoji = emojiMap.endings[ending];
            
            // Seleccionar un tÃ­tulo aleatorio
            const randomTitle = storyTitles[Math.floor(Math.random() * storyTitles.length)];
            storyTitle.textContent = randomTitle;
            
            // Crear la historia
            let story = '';
            
            // IntroducciÃ³n
            let intro = `<p class="story-paragraph">Era ${weatherText} ${weatherEmoji} en ${placeText} ${placeEmoji}. La Enfermera Panda ğŸ¼ y el Doctor Mono ğŸ’ estaban listos para ayudar a quien lo necesitara.`;
            
            if (childName) {
                intro += ` Un niÃ±o llamado ${childName} habÃ­a llegado con ${problemText} ${problemEmoji} y necesitaba ayuda especial.`;
            } else {
                intro += ` Alguien llegÃ³ con ${problemText} ${problemEmoji} y necesitaba ayuda especial.`;
            }
            
            intro += `</p>`;
            story += intro;
            
            // Desarrollo
            let development = `
            <p class="story-paragraph">"Â¡No te preocupes!" dijo la Enfermera Panda con una sonrisa reconfortante. "El Doctor Mono y yo sabemos exactamente quÃ© hacer para ayudarte."</p>
            
            <p class="story-paragraph">Mientras pensaban en una soluciÃ³n, apareciÃ³ ${friendText} ${friendEmoji} quien traÃ­a consigo ${magicObjectText} ${magicObjectEmoji}. "Â¡QuizÃ¡s esto pueda ayudar!" exclamÃ³ con entusiasmo.</p>
            
            <p class="story-paragraph">El Doctor Mono dio un salto de alegrÃ­a. "Â¡QuÃ© buena idea! Con esto podremos resolver el problema de una forma divertida y especial."</p>
            `;
            
            // Personalizar segÃºn el problema
            let problemSpecific = '';
            switch(problem) {
                case 'resfriado':
                    problemSpecific = `<p class="story-paragraph">La Enfermera Panda preparÃ³ una manta calientita, mientras el Doctor Mono usÃ³ ${magicObjectText} para crear una medicina con sabor a frutas tropicales. Los estornudos comenzaron a desaparecer como por arte de magia.</p>`;
                    break;
                case 'miedo':
                    problemSpecific = `<p class="story-paragraph">El Doctor Mono utilizÃ³ ${magicObjectText} para iluminar las sombras con luces de colores. "Â¡Mira! Las sombras solo quieren jugar contigo", explicÃ³ con una sonrisa tranquilizadora.</p>`;
                    break;
                case 'herida':
                    problemSpecific = `<p class="story-paragraph">La Enfermera Panda limpiÃ³ la herida con agua tibia mientras cantaba una canciÃ³n alegre. Luego, el Doctor Mono pasÃ³ ${magicObjectText} por encima, haciendo que apareciera una venda de colores brillantes que contaba chistes.</p>`;
                    break;
                case 'tristeza':
                    problemSpecific = `<p class="story-paragraph">"Las lÃ¡grimas son como pequeÃ±as lluvias que limpian el corazÃ³n", dijo la Enfermera Panda mientras abrazaba con cariÃ±o. El Doctor Mono utilizÃ³ ${magicObjectText} para crear burbujas de recuerdos felices que flotaban alrededor.</p>`;
                    break;
                default:
                    problemSpecific = `<p class="story-paragraph">La Enfermera Panda y el Doctor Mono trabajaron juntos, usando ${magicObjectText} de manera creativa. Con cada minuto que pasaba, el problema se iba haciendo mÃ¡s pequeÃ±o hasta casi desaparecer.</p>`;
            }
            
            story += development + problemSpecific;
            
            // ConclusiÃ³n
            let conclusion = `
            <p class="story-paragraph">${friendText} aplaudÃ­a emocionado mientras veÃ­a cÃ³mo todo mejoraba. "Â¡SabÃ­a que ustedes podrÃ­an solucionarlo! Son los mejores ayudantes del mundo."</p>
            
            <p class="story-paragraph">Pronto, el problema estaba completamente resuelto. Para celebrar, todos decidieron terminar el dÃ­a con ${endingText} ${endingEmoji}.</p>
            
            <p class="story-paragraph">"Recuerda", dijo la Enfermera Panda con dulzura, "cuando tengas un problema, siempre puedes pedir ayuda. Estaremos aquÃ­ para ti."</p>
            
            <p class="story-paragraph">"Â¡Y haremos que sea divertido resolverlo!" aÃ±adiÃ³ el Doctor Mono dando una voltereta en el aire.</p>
            
            <p class="story-paragraph">Y asÃ­, con sonrisas en sus rostros y corazones llenos de alegrÃ­a, terminÃ³ otra maravillosa aventura de la Enfermera Panda y el Doctor Mono. Â¿QuÃ© nueva misiÃ³n les esperarÃ¡ maÃ±ana? ğŸ¼â¤ï¸ğŸ’</p>
            `;
            
            story += conclusion;
            
            // Simular tiempo de carga
            setTimeout(() => {
                loadingIndicator.style.display = 'none';
                storyContainer.style.display = 'block';
                storyContent.innerHTML = story;
                
                // Animar los pÃ¡rrafos secuencialmente
                const paragraphs = document.querySelectorAll('.story-paragraph');
                paragraphs.forEach((paragraph, index) => {
                    setTimeout(() => {
                        paragraph.style.animation = 'fadeIn 1s forwards';
                    }, index * 800);
                });
                
                // Aplicar Twemoji a la historia
                twemoji.parse(storyContent, {
                    folder: 'svg',
                    ext: '.svg'
                });
            }, 2000);
        }
        
        function resetStory() {
            storyContainer.style.display = 'none';
            formContainer.style.display = 'block';
            
            // Resetear los campos del formulario si es necesario
            document.getElementById('childName').value = '';
            
            // Scroll suave hasta el formulario
            formContainer.scrollIntoView({ behavior: 'smooth' });
        }
    </script>
</body>
</html>
